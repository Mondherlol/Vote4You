{% extends 'base.html.twig' %}

{% block title %}New Sondage{% endblock %}

{% block body %}
    <h1>Ajouter un nouveau sondage</h1>


    {{ form_start(form) }}

    <!-- Titre -->
    <div class="form-group">
        {{ form_label(form.titre, 'Titre du sondage') }}
        {{ form_widget(form.titre, { 'attr': { 'class': 'form-control' } }) }}
        {{ form_errors(form.titre) }}
    </div>

    <!-- Description -->
    <div class="form-group">
        {{ form_label(form.description, 'Description') }}
        {{ form_widget(form.description, { 'attr': { 'class': 'form-control' } }) }}
        {{ form_errors(form.description) }}
    </div>

    <!-- Sondage Public -->
    <div class="form-group">
        {{ form_label(form.publique, 'Sondage publique ?') }}
        {{ form_widget(form.publique) }}
        {{ form_errors(form.publique) }}
    </div>

    <!-- Date d'expiration -->
    <div class="form-group">
        {{ form_label(form.date_fin, 'Date d’expiration') }}
        {{ form_widget(form.date_fin, { 'attr': { 'class': 'form-control' } }) }}
        {{ form_errors(form.date_fin) }}
    </div>

    <!-- Image -->
    <div class="form-group">
        {{ form_label(form.imageFile, 'Image du sondage') }}
        {{ form_widget(form.imageFile, { 'attr': { 'class': 'form-control-file' } }) }}
        {{ form_errors(form.imageFile) }}
    </div>

    <!-- Thèmes -->
    <div class="form-group">
        <label for="themes">Thèmes associés</label>
        <div id="themes">
            <input type="text" name="themes[]" class="form-control" placeholder="Nom du thème">
            <button type="button" id="add-theme" class="btn btn-secondary mt-2">Ajouter un thème</button>
        </div>
    </div>


    <div class="form-group">
        <label for="choices">Choix associés</label>
        <div id="choices">
            <!-- Premier choix -->
            <div class="choice mt-2">
                <!-- Titre du choix -->
                <input type="text" name="choix[0][titreChoix]" class="form-control" placeholder="Titre du choix">

                <!-- Image du choix -->
                <label for="choix[0][imageChoixFile]">Image du choix (facultatif)</label>
                <input type="file" name="choix[0][imageChoixFile]" class="form-control-file mt-1">
            </div>
        </div>

        <!-- Bouton pour ajouter un nouveau choix -->
        <button type="button" id="add-choice" class="btn btn-secondary mt-2">Ajouter un choix</button>
    </div>
    <button type="submit" class="btn btn-primary">Créer le sondage</button>

    {{ form_end(form) }}
    <a href="{{ path('app_sondage_index') }}">back to list</a>

    <script>
        // Ajouter un thème
        document.getElementById('add-theme').addEventListener('click', function () {
            const container = document.getElementById('themes');
            const input = document.createElement('input');
            input.type = 'text';
            input.name = 'themes[]';
            input.classList.add('form-control', 'mt-2');
            input.placeholder = 'Nom du thème';
            container.insertBefore(input, this); // Insère avant le bouton "Ajouter un thème"
        });

        // Ajouter un choix
        // Fonction pour ajouter un choix
        let choiceIndex = 1; // Gère les index des choix dynamiques

        document.getElementById('add-choice').addEventListener('click', function () {
            const container = document.getElementById('choices');

            // Créer une nouvelle div pour un choix
            const choiceDiv = document.createElement('div');
            choiceDiv.classList.add('choice', 'mt-2');

            // Titre du choix
            const inputTitle = document.createElement('input');
            inputTitle.type = 'text';
            inputTitle.name = 'choix[${choiceIndex}][titreChoix]';
            inputTitle.classList.add('form-control');
            inputTitle.placeholder = 'Titre du choix';

            // Image du choix
            const inputImage = document.createElement('input');
            inputImage.type = 'file';
            inputImage.name = 'choix[${choiceIndex}][imageChoixFile]';
            inputImage.classList.add('form-control-file', 'mt-1');

            // Ajouter les champs dans la div
            choiceDiv.appendChild(inputTitle);
            choiceDiv.appendChild(inputImage);

            // Ajouter la nouvelle div au conteneur
            container.appendChild(choiceDiv);
            // Incrémenter l'index des choix
            choiceIndex++;
        });
    </script>

{% endblock %}
